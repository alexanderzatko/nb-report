<!DOCTYPE html>
<html>
  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Collect snow information from skiers">
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="styles.css">
  <script src="/vendor/exif.js"></script>
  <script type="importmap">
    {
    "imports": {
    "i18next": "/node_modules/i18next/dist/esm/i18next.js",
    "i18next-http-backend": "/node_modules/i18next-http-backend/esm/index.js",
    "i18next-browser-languagedetector": "/node_modules/i18next-browser-languagedetector/dist/esm/i18nextBrowserLanguageDetector.js"
    }
    }
    </script>
  <title data-i18n="app.title">Report Snow Conditions</title>
</head>
<body>
    <main>
      <div id="auth-container">
        <div id="login-container">
          <button id="login-button" class="auth-button login">
            <img src="/icon/login-icon.svg" alt="Login" class="login-icon">
          </button>
          <p id="login-text"></p>
        </div>
      </div>

      <div id="dashboard-container" style="display: none;">
          <div class="dashboard-header">
              <h2 data-i18n="app.header">Report — Snow Conditions</h2>
          </div>

          <div class="dashboard-grid">
              <a href="#" class="dashboard-card" id="snow-report-link">
                  <div class="card-icon">
                    <i class="glyphicon glyphicon-list-alt"></i>
                      <!-- <img src="/icon/report-icon.svg" alt="New Report"> -->
                  </div>
                  <h3 data-i18n="dashboard.newReport">New Report</h3>
                  <p data-i18n="dashboard.newReportDesc">Submit a new snow condition report</p>
              </a>

              <div class="dashboard-card disabled" data-feature="gps-recording">
                  <div class="card-icon">
                    <i class="glyphicon glyphicon-map-marker"></i>
                      <!-- <img src="/icon/reports-icon.svg" alt="My Reports"> -->
                  </div>
                  <h3 data-i18n="dashboard.recordGps">Record GPS</h3>
                  <p data-i18n="dashboard.recordGpsDesc">Start GPS recording</p>
              </div>
              
              <a href="#" id="settings-link" class="dashboard-card">
                  <div class="card-icon">
                      <!-- <img src="/icon/profile-icon.svg" alt="Preferences"> -->
                  </div>
                  <h3 data-i18n="dashboard.preferences">Preferences</h3>
                  <p data-i18n="dashboard.preferencesDesc">Manage your preferences</p>
              </a>
          </div>
      </div>

      <div id="settings-container" style="display: none;">
          <div class="dashboard-header">
              <h2 id="settings-title" data-i18n="settings.title">Settings</h2>
          </div>
          <div class="settings-content">
              <div class="settings-buttons">
                  <button type="button" id="dashboard-button" class="settings-button" data-i18n="settings.returnToDashboard">Return to Dashboard</button>
                  <button type="button" id="logout-button" class="settings-button" data-i18n="auth.logout">Logout</button>
              </div>
          </div>
      </div>

      <form id="snow-report-form" novalidate style="display:none;">

        <!-- Regular User Section -->
        <div id="regular-user-section" class="form-section">

          <div class="form-group">
            <div class="form-title" data-i18n="form.formTitleRegular">Vytvoriť správu</div>
            <label for="report-title" class="required-field" data-i18n="form.reportTitle"></label>
            <input type="text" id="report-title" required data-i18n-validate="form.validation.required"/>
            <div class="validation-message"></div>
          </div>
            
          <div class="form-group">
            <label for="country" class="required-field" data-i18n="form.country">Country:</label>
            <select id="country" 
                    required 
                    data-i18n-validate="form.validation.required">
              <option value="">Select country</option>
            </select>
            <div class="validation-message"></div>
          </div>
          
          <div class="form-group">
            <label for="region" class="required-field" data-i18n="form.region">Region:</label>
            <select id="region" 
                    required 
                    data-i18n-validate="form.validation.required">
              <option value="">Select region</option>
            </select>
            <div class="validation-message"></div>
          </div>
        
          <div class="form-group">
            <label for="report-date" data-i18n="form.reportDate">Report Date:</label>
            <input 
              type="date" 
              id="report-date"
              name="report-date"
              required
              class="form-control"
              >
          </div>
            
          <div class="form-group">
            <label for="classic-style" data-i18n="form.classicStyle">Classic Style:</label>
            <select id="classic-style" data-i18n="form.trackConditions">
              <!-- Options populated dynamically -->
            </select>
          </div>

          <div class="form-group">
            <label for="free-style" data-i18n="form.freeStyle">Free Style:</label>
            <select id="free-style" data-i18n="form.trackConditions">
              <!-- Options populated dynamically -->
            </select>
          </div>
        	
          <div class="form-group">
            <label for="snow-depth250" data-i18n="form.snowDepth250">Hĺbka snehu v 250 m.n.m. (cm):</label>
            <input type="number" id="snow-depth250" name="snowDepth250" min="0" />
          </div>
          
          <div class="form-group">
            <label for="snow-depth500" data-i18n="form.snowDepth500">Hĺbka snehu v 500 m.n.m. (cm):</label>
            <input type="number" id="snow-depth500" name="snowDepth500" min="0" />
          </div>
          
          <div class="form-group">
            <label for="snow-depth750" data-i18n="form.snowDepth750">Hĺbka snehu v 750 m.n.m. (cm):</label>
            <input type="number" id="snow-depth750" name="snowDepth750" min="0" />
          </div>
          
          <div class="form-group">
            <label for="snow-depth1000" data-i18n="form.snowDepth1000">Hĺbka snehu nad 1000 m.n.m. (cm):</label>
            <input type="number" id="snow-depth1000" name="snowDepth1000" min="0" />
          </div>

          <label for="snow-age" data-i18n="form.snowAge">Age:</label>
          <select id="snow-age" data-i18n="form.snowAgeOptions">
            <!-- Options populated dynamically -->
          </select>
  
          <label for="wetness" data-i18n="form.wetness">Moisture:</label>
          <select id="wetness" data-i18n="form.wetnessOptions">
            <!-- Options populated dynamically -->
          </select>

          <div class="common-section-placeholder" data-position="middle"></div>

          <!-- GPX Section -->
          <div class="form-section gpx-section">
            <label data-i18n="form.gpx.groupLabel">GPX Trip Record File</label>
            <select id="gpx-option" class="gpx-select">
                <option value="none" data-i18n="form.gpx.options.none">No record</option>
                <option id="existing-gpx-option" value="existing" data-i18n="form.gpx.options.existing">Include recorded track</option>
                <option value="upload" data-i18n="form.gpx.options.upload">Upload new GPX file</option>
            </select>
            
            <div id="gpx-info-display" class="gpx-info" style="display: none"></div>
            
            <div id="gpx-upload-container" class="gpx-upload-controls">
                <button type="button" id="gpx-upload-btn" data-i18n="form.gpx.uploadButton">Select GPX file</button>
                <input type="file" id="gpx-file-input" style="display: none">
                <span id="gpx-filename" class="gpx-filename"></span>
                <div id="gpx-error" class="validation-message"></div>
            </div>
  
            <div id="gpx-confirm-dialog" class="modal" style="display: none;">
              <div class="modal-content">
                <h3 data-i18n="form.gpx.confirmReplace">Replace Existing Track?</h3>
                <div id="existing-track-info"></div>
                <p data-i18n="form.gpx.replaceQuestion">Do you want to replace it with the new track?</p>
                <div class="modal-buttons">
                  <button type="button" id="gpx-confirm-cancel" class="cancel-button" data-i18n="form.gpx.cancel">Cancel</button>
                  <button type="button" id="gpx-confirm-replace" class="photo-button" data-i18n="form.gpx.replace">Replace</button>
                </div>
              </div>
            </div>
  
          </div>
        </div>

        <!-- Admin Section -->
        <div id="admin-section" class="form-section" style="display: none;">   
            <div class="form-title" data-i18n="form.formTitleAdmin">Vytvoriť správu</div>

            <div class="form-group">
                <label for="ski-center-name" data-i18n="form.skicenterName">Stredisko:</label>
                <input type="hidden" id="ski-center-id" />
                <div id="ski-center-name"></div>
            </div>
            
            <div class="form-group">
                <label for="snow-depth-total" class="required-field" data-i18n="form.snowDepthTotal">Celková výška snehu (cm):</label>
                <input type="number" id="snow-depth-total" name="snowDepthTotal" min="0" data-i18n-validate="form.validation.required" />
                <div class="validation-message"></div>
            </div>
            
            <div class="form-group">
                <label for="snow-depth-new" class="" data-i18n="form.snowDepthNew">Nový sneh (cm):</label>
                <input type="number" id="snow-depth-new" name="snowDepthNew" min="0" data-i18n-validate="form.validation.required" />
                <div class="validation-message"></div>
            </div>

            <div class="common-section-placeholder" data-position="middle"></div>

        </div>

        <template id="common-section">   
          <div class="form-group">
          	<label for="snow-type" data-i18n="form.snowType">Typ snehu:</label>
          	<select id="snow-type" name="snowType" data-i18n-validate="form.validation.required">
              <!-- Options populated dynamically -->
          	</select>
          	<div class="validation-message"></div>
          </div>
  
          <!-- Photos upload -->
          <div class="form-section photos-section">
            <div id="photo-preview-container"></div>
            <button type="button" id="select-photos" class="photo-button" data-i18n="form.selectPhotos">Select Photos</button>
            <button type="button" id="take-photo" class="photo-button" data-i18n="form.takePhoto">Take Photo</button>
            <input type="file" id="photo-file-input" accept="image/*" multiple style="display: none;">
            <input type="file" id="camera-input" accept="image/*" capture="environment" style="display: none;">
          </div>
        </template>

        <div class="form-group">
          <label for="report-note" class="required-field" data-i18n="form.reportNote">Report</label>
          <textarea id="report-note" required name="report_note" data-i18n-validate="form.validation.required"></textarea>
          <div class="validation-message"></div>
        </div>

        <!-- Trails Section (for admins) -->
        <div id="trails-section" class="form-section" style="display: none;">
          <div id="trails-header">
            <h3 data-i18n="form.trailsSection">Bežkárske trate</h3>
          </div>
          <div id="trails-container">
              <!-- Trail items will be added here dynamically -->
          </div>
        </div>
                
        <!-- the rewards section -->        
        <div id="rewards-section" class="rewards-section" style="display: none;">
          <h3 data-i18n="form.rewards.sectionTitle">Rewards</h3>
          <div class="time-elapsed">
            <span data-i18n="form.rewards.timeElapsed">Time since opening this form:</span>
            <span id="elapsed-time" class="time-display">
              <span id="elapsed-hours" class="time-unit hours">00</span>
              <span class="time-label hours">hrs.</span>
              <span id="elapsed-minutes" class="time-unit minutes">00</span>
              <span class="time-label minutes">min.</span>
              <span id="elapsed-seconds" class="time-unit seconds">00</span>
              <span class="time-label seconds">sec.</span>
            </span>
          </div>

          <div class="form-group">
            <label for="labor-time" data-i18n="form.rewards.laborTime">Labor time</label>
            <div class="input-with-units">
              <input type="number" id="labor-time" name="labor-time" min="0">
              <span data-i18n="form.rewards.laborTimeUnits">minutes</span>
            </div>
            <p class="help-text" data-i18n="form.rewards.laborTimeHelp"></p>
          </div>

          <div class="form-group">
            <label for="reward-requested" data-i18n="form.rewards.rewardRequested">Reward requested</label>
            <div class="input-with-units">
              <input type="number" id="reward-requested" name="reward-requested" value="0" min="0">
              <span data-i18n="form.rewards.rewardRequestedUnits">Merits</span>
            </div>
            <p class="help-text" data-i18n="form.rewards.rewardRequestedHelp"></p>
          </div>
        </div>
        
        <div class="form-buttons">
            <button type="button" id="cancel-button" class="cancel-button" data-i18n="form.cancel">Cancel</button>
            <button type="submit" data-i18n="form.submit">Submit Report</button>
        </div>
      </form>
    </main>

    <script type="module" src="/js/app.js"></script>
    <script type="module" src="/js/i18n.js"></script>
</body>
</html>
